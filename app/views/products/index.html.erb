<h1 class="text-center">Inventory Management System</h1>

<%= link_to 'Add Warehouse', new_warehouse_path, class: 'btn btn-primary float-right mb-3' %>

<table id="products" class="table table-striped table-bordered cell-border text-center">
  <thead>
    <tr>
      <% Product.table_header_names.each do |column_name| %>
        <td><%= column_name %></td>
      <% end %>
    </tr>
  </thead>
</table>

<script>
  $(document).on('turbolinks:load', function(){
    var table_data = <%= "#{@products}".html_safe %>

    if ($("#products_wrapper").length == 0) {
      $('#products').dataTable({
        data: table_data['details'],
        columns: table_data['column_names'],
        rowCallback: function(row, data, index) {
          for(i in data){
            if (typeof data[i] == 'number' && data[i] < 10){
              $(row).find('td').filter(function(){ return $(this).text() == data[i] }).addClass('bg-danger text-white')   
            }  
          }
        },
        columnDefs: [
          {
            targets: 0,
            render: function ( data, type, row, meta ) {
              if(type === 'display'){
                data = '<a href="'+ window.location.origin + '/products/' + (data) + '/edit/">' + data + '</a>';
              }
              return data;
            }
          }
        ]
      })
    }  
  })
</script>